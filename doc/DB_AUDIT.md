# DeadLine - –ê—É–¥–∏—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –û–±–∑–æ—Ä
–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Drizzle ORM —Å PostgreSQL. –°—Ö–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 6 —Ñ–∞–π–ª–æ–≤ —Å –æ–±—â–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º 40+ —Ç–∞–±–ª–∏—Ü.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ö–µ–º—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã —Å—Ö–µ–º:
1. `src/lib/db/schema.ts` - –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø—Ä–æ–µ–∫—Ç—ã, –∑–∞–¥–∞—á–∏)
2. `src/lib/db/schema-boards.ts` - –î–æ—Å–∫–∏ Kanban/Scrum
3. `src/lib/db/schema-swimlanes.ts` - Swimlanes –¥–ª—è –¥–æ—Å–æ–∫
4. `src/lib/db/schema-filters.ts` - –§–∏–ª—å—Ç—Ä—ã –∏ —à–∞–±–ª–æ–Ω—ã
5. `src/lib/db/schema-permissions.ts` - –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ —Ä–æ–ª–∏
6. `src/lib/db/schema-analytics.ts` - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã

## –ê–Ω–∞–ª–∏–∑ —Ç–∞–±–ª–∏—Ü

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞–ø–∫–∞ `drizzle/` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –ø—É—Å—Ç–æ–π `_journal.json`, –Ω–µ—Ç SQL –º–∏–≥—Ä–∞—Ü–∏–π
**–†–∏—Å–∫:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å—Ö–µ–º—É –≤ –ø—Ä–æ–¥–∞–∫—à–Ω
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

#### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TypeScript
**–ü—Ä–æ–±–ª–µ–º–∞:** `tsconfig.json` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `target: "es5"`, —á—Ç–æ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å Drizzle
**–û—à–∏–±–∫–∞:** "Transforming const to the configured target environment ("es5") is not supported yet"
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–∏—Ç—å target –Ω–∞ "es2020" –∏–ª–∏ –≤—ã—à–µ

### üü° –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

#### 3. –°–ª–æ–∂–Ω—ã–µ JSON –ø–æ–ª—è –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
**–¢–∞–±–ª–∏—Ü—ã:** –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü –∏—Å–ø–æ–ª—å–∑—É—é—Ç `jsonb` –ø–æ–ª—è –±–µ–∑ —Å—Ö–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `user.preferences` (JSON)
- `workspaceMember.skills` (JSON)
- `board.settings` (—Å–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- `aiConversation.context` (JSON)

#### 4. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª—è—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç composite indexes –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

#### 5. CASCADE vs SET NULL –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è FK constraints
```typescript
// SET NULL
leadId: uuid("lead_id").references(() => user.id, { onDelete: "set null" }),

// CASCADE
userId: uuid("user_id").notNull().references(() => user.id, { onDelete: "cascade" }),
```

## –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–∞–±–ª–∏—Ü

### Core Tables (schema.ts)

#### ‚úÖ –•–æ—Ä–æ—à–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ:
- `user` - –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ constraints
- `session` - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ FK –∏ unique constraints
- `workspace` - –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å owner FK

#### ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è:
- `issue` - –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ nullable –ø–æ–ª–µ–π, embedding –ø–æ–ª–µ –∫–∞–∫ text (–Ω–µ JSON)
- `aiConversation` - context –∫–∞–∫ text –≤–º–µ—Å—Ç–æ jsonb

### Board Tables (schema-boards.ts)

#### ‚úÖ –•–æ—Ä–æ—à–æ:
- `board` - –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å FK
- `boardColumn` - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–≤—è–∑–∏

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:
- `board.settings` - –°–ª–æ–∂–Ω—ã–π JSON –±–µ–∑ type safety
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫

### Analytics Tables (schema-analytics.ts)

#### ‚úÖ –•–æ—Ä–æ—à–æ:
- `boardMetrics` - –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ—Ç—Ä–∏–∫
- `boardBurndownData` - –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `decimal` –≤–º–µ—Å—Ç–æ `numeric` (PostgreSQL —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ)
- –°–ª–æ–∂–Ω—ã–µ JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–µ–∑ —Å—Ö–µ–º

## –°–≤—è–∑–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### üîó –û—Å–Ω–æ–≤–Ω—ã–µ —Å–≤—è–∑–∏:

```
user (1) ‚îÄ‚îÄ‚îÄ‚îÄ (M) session
user (1) ‚îÄ‚îÄ‚îÄ‚îÄ (M) workspace (owner)
user (1) ‚îÄ‚îÄ‚îÄ‚îÄ (M) workspaceMember
workspace (1) ‚îÄ‚îÄ‚îÄ‚îÄ (M) project
project (1) ‚îÄ‚îÄ‚îÄ‚îÄ (M) issue
user (1) ‚îÄ‚îÄ‚îÄ‚îÄ (M) aiConversation
workspace (1) ‚îÄ‚îÄ‚îÄ‚îÄ (M) aiTaskSuggestion
```

### ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–≤—è–∑–µ–π:

1. **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–≤—è–∑–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞—Ç—å —Ü–∏–∫–ª—ã
2. **Orphaned records:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ workspace –º–æ–≥—É—Ç –æ—Å—Ç–∞—Ç—å—Å—è –≤–∏—Å—è—á–∏–µ aiConversation
3. **Missing FKs:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–≤—è–∑–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

#### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å tsconfig.json
```json
{
  "compilerOptions": {
    "target": "es2020",
    "module": "esnext",
    ...
  }
}
```

#### 2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
npx drizzle-kit generate:pg
```

#### 3. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```sql
-- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_issue_project_status ON issue(project_id, status);
CREATE INDEX idx_issue_assignee ON issue(assignee_id);
CREATE INDEX idx_board_workspace ON board(workspace_id, project_id);
CREATE INDEX idx_ai_conversation_user ON ai_conversation(user_id, created_at);
```

#### 4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å JSON –ø–æ–ª—è
```typescript
// –ë—ã–ª–æ:
embedding: text("embedding"),

// –°—Ç–∞–ª–æ:
embedding: jsonb("embedding").$type<number[]>(),
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (Critical)
1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** - –∏–∑–º–µ–Ω–∏—Ç—å target –Ω–∞ es2020
2. **–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏** - —Å–æ–∑–¥–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ SQL –º–∏–≥—Ä–∞—Ü–∏–∏
3. **–î–æ–±–∞–≤–∏—Ç—å FK constraints** - –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è (High)
1. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã** - –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. **–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞—Ç—å JSON –ø–æ–ª—è** - –∑–∞–º–µ–Ω–∏—Ç—å text/jsonb –Ω–∞ typed —Å—Ö–µ–º—ã
3. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å FK —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** - CASCADE vs SET NULL

### –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (Medium)
1. **–î–æ–±–∞–≤–∏—Ç—å check constraints** - –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤ –ë–î
2. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É** - –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
3. **–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

## –†–∏—Å–∫–∏ –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

### üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏:
1. **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö** - –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
3. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** - –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ FK —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–µ —Ä–∏—Å–∫–∏:
1. **Type safety** - JSON –ø–æ–ª—è –±–µ–∑ —Å—Ö–µ–º
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
3. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** - —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π

## –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Å—Ö–µ–º—ã

- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü:** 40+
- **–¢–∞–±–ª–∏—Ü —Å FK:** 35+
- **–¢–∞–±–ª–∏—Ü —Å JSON –ø–æ–ª—è–º–∏:** 15+
- **–¢–∞–±–ª–∏—Ü –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤:** 90%
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 3
- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:** 5

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
3. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
4. –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
